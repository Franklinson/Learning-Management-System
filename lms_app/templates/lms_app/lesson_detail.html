{% extends "lms_app/base.html" %} {% block title %}{{ lesson.title }}{% endblock
%} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ lesson.title }}</h1>
    <div>
        {% if user.is_authenticated and user.role == 'student' %} {% if
        is_completed %}
        <span class="badge bg-success me-2">Completed</span>
        {% else %}
        <span class="badge bg-warning text-dark me-2">In Progress</span>
        {% if can_mark_completed %}
        <form
            action="{% url 'mark_lesson_completed' pk=lesson.pk %}"
            method="post"
            style="display: inline"
        >
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-success">
                Mark Complete
            </button>
        </form>
        {% endif %} {% endif %} {% endif %} {% if lesson.course.instructor ==
        user or user.is_superuser %}
        <a
            href="{% url 'lesson_update' pk=lesson.pk %}"
            class="btn btn-warning me-2"
            >Edit Lesson</a
        >
        <a href="{% url 'lesson_delete' pk=lesson.pk %}" class="btn btn-danger"
            >Delete Lesson</a
        >
        {% endif %}
    </div>
</div>

<p class="lead">
    <strong>Course:</strong>
    <a href="{% url 'course_detail' pk=lesson.course.pk %}"
        >{{ lesson.course.title }}</a
    >
</p>
<p><strong>Order:</strong> {{ lesson.order }}</p>

<div class="card card-body mb-4">
    <h3 class="card-title">Lesson Content</h3>
    <div class="card-text">{{ lesson.content|safe }}</div>
</div>

{% if lesson.quiz %}
<div class="card card-body mb-4">
    <h3 class="card-title">
        Associated Quiz:
        <a href="{% url 'quiz_detail' pk=lesson.quiz.pk %}"
            >{{ lesson.quiz.title }}</a
        >
    </h3>
    {% if user.is_authenticated and user.role == 'student' %} {% if
    quiz_attempted %}
    <p class="text-muted">
        You have attempted this quiz. Your latest score:
        <strong
            >{{ latest_quiz_score }} / {{ lesson.quiz.questions.count }}</strong
        >
    </p>
    <a
        href="{% url 'take_quiz' pk=lesson.quiz.pk %}"
        class="btn btn-info btn-sm"
        >Retake Quiz</a
    >
    {% else %} {% if is_completed %}
    <a
        href="{% url 'take_quiz' pk=lesson.quiz.pk %}"
        class="btn btn-primary btn-sm"
        >Take Quiz Now</a
    >
    {% else %}
    <button class="btn btn-primary btn-sm" disabled>
        Complete lesson to take quiz
    </button>
    {% endif %} {% endif %} {% else %}
    <p class="text-muted">
        Login as a student and complete the lesson to take this quiz.
    </p>
    {% endif %}
</div>
{% endif %}

<div class="mt-4">
    <a
        href="{% url 'course_detail' pk=lesson.course.pk %}"
        class="btn btn-secondary"
        >Back to Course</a
    >
</div>
{% endblock %}
