{% extends "lms_app/base.html" %} {% block title %}{{ quiz.title }}{% endblock
%} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ quiz.title }}</h1>
    <div>
        {% if user.is_authenticated and user.role == 'student' %} {% if
        is_student_enrolled %} {% if has_attempted_quiz %}
        <p class="mb-0 text-muted">
            Your latest score:
            <strong
                >{{ latest_attempt_score }} / {{ quiz.questions.count }}</strong
            >
        </p>
        <a href="{% url 'take_quiz' pk=quiz.pk %}" class="btn btn-primary me-2"
            >Retake Quiz</a
        >
        {% else %}
        <a href="{% url 'take_quiz' pk=quiz.pk %}" class="btn btn-success me-2"
            >Start Quiz</a
        >
        {% endif %} {% else %}
        <span class="badge bg-secondary me-2">Not Enrolled in Course</span>
        <button class="btn btn-success me-2" disabled>Take Quiz</button>
        {% endif %} {% else %} {% if quiz.lesson.course.instructor == user or
        user.is_superuser %}
        <a
            href="{% url 'quiz_update' pk=quiz.pk %}"
            class="btn btn-warning me-2"
            >Edit Quiz</a
        >
        <a href="{% url 'quiz_delete' pk=quiz.pk %}" class="btn btn-danger"
            >Delete Quiz</a
        >
        {% endif %} {% endif %}
    </div>
</div>

<p class="lead">
    <strong>Associated Lesson:</strong>
    <a href="{% url 'lesson_detail' pk=quiz.lesson.pk %}" class="link-info"
        >{{ quiz.lesson.title }}</a
    >
</p>

<hr />

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Questions</h2>
    {% if quiz.lesson.course.instructor == user or user.is_superuser %}
    <a
        href="{% url 'question_create' quiz_pk=quiz.pk %}"
        class="btn btn-success"
        >Add New Question</a
    >
    {% endif %}
</div>

{% if quiz.questions.all %}
<div class="list-group">
    {% for question in quiz.questions.all %}
    <div class="list-group-item mb-3 shadow-sm">
        <h5>{{ forloop.counter }}. {{ question.text }}</h5>
        <div class="ms-4 mt-2">
            {% for answer in question.answers.all %}
            <p
                class="mb-1 {% if answer.is_correct %}text-success fw-bold{% else %}text-danger{% endif %}"
            >
                <span class="badge bg-secondary me-2"
                    >{{ forloop.counter }}</span
                >{{ answer.text }} {% if answer.is_correct %}(Correct){% endif
                %}
            </p>
            {% empty %}
            <p class="text-muted">No answers defined for this question yet.</p>
            {% endfor %}
        </div>
        {% if quiz.lesson.course.instructor == user or user.is_superuser %}
        <div class="mt-3 border-top pt-2">
            <a
                href="{% url 'answer_create' question_pk=question.pk %}"
                class="btn btn-outline-success btn-sm me-2"
                >Add Answer</a
            >
            <a
                href="{% url 'question_update' pk=question.pk %}"
                class="btn btn-outline-warning btn-sm me-2"
                >Edit Question</a
            >
            <a
                href="{% url 'question_delete' pk=question.pk %}"
                class="btn btn-outline-danger btn-sm"
                >Delete Question</a
            >
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<p>
    No questions available for this quiz yet. Add some questions to get started!
</p>
{% endif %}

<div class="mt-4">
    <a
        href="{% url 'lesson_detail' pk=quiz.lesson.pk %}"
        class="btn btn-secondary"
        >Back to Lesson</a
    >
</div>
{% endblock %}
