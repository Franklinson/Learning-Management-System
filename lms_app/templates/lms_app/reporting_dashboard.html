{% extends "lms_app/base.html" %}

{% block title %}Reporting Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Reporting Dashboard</h1>
</div>

{% if course_data %}
    {% for data in course_data %}
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-primary text-white">
            <h2 class="h4 mb-0">{{ data.course.title }} ({{ data.total_students_enrolled }} Students Enrolled)</h2>
        </div>
        <div class="card-body">
            {% if data.students_progress %}
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col">Student</th>
                        <th scope="col">Lessons Completed</th>
                        <th scope="col">Completion %</th>
                        <th scope="col">Average Quiz Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student_progress in data.students_progress %}
                    <tr>
                        <td>{{ student_progress.student.username }}</td>
                        <td>{{ student_progress.completed_lessons }} / {{ student_progress.total_lessons }}</td>
                        <td>{{ student_progress.lesson_completion_percentage|floatformat:2 }}%</td>
                        <td>{{ student_progress.average_quiz_score|floatformat:2 }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No students have made progress in this course yet.</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
{% else %}
    <p>No courses available for reporting.</p>
{% endif %}
{% endblock %}
